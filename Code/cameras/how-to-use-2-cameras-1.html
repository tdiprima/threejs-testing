<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>How to use 2 cameras three.js</title>
  <link href="/css/main.css" rel="stylesheet">
</head>
<body>

<script type="importmap">{
  "imports": {
    "three": "/build/three.module.js",
    "three/addons/": "/jsm/"
  }
}</script>
<script async src="/es-module-shims-1.3.6/dist/es-module-shims.js"></script>

<script type="module">
  import * as THREE from "three";
  import {OrbitControls} from "three/addons/controls/OrbitControls.js";

  const laurel = "#016f01";
  let aspect = window.innerWidth / window.innerHeight;
  let insetWidth, insetHeight;
  let scene = new THREE.Scene();

  const createCamera = (fov, name) => {
    let camera = new THREE.PerspectiveCamera(fov, aspect, 0.01, 500);
    if (name) {
      camera.name = name;
    }
    console.log("camera", camera);
    return camera;
  };

  let camera = createCamera(70, "PlayerCam");
  camera.position.z = 10;
  camera.position.y = 2;
  camera.lookAt(0, 0, 0);

  let cameraTop = createCamera(90, "OverheadCam");
  cameraTop.position.set(0, 10, 0);
  cameraTop.lookAt(0, 0, -10);

  camera.add(cameraTop);
  scene.add(camera);

  let helper = new THREE.CameraHelper(camera);
  scene.add(helper);

  let geometry = new THREE.BoxGeometry(2, 2, 2);
  let material = new THREE.MeshNormalMaterial();
  let mesh = new THREE.Mesh(geometry, material);
  scene.add(mesh);

  let renderer = new THREE.WebGLRenderer();
  renderer.setSize(window.clientWidth, window.clientHeight);
  renderer.setPixelRatio(window.devicePixelRatio);
  document.body.append(renderer.domElement);
  renderer.render(scene, camera);
  renderer.setClearColor(laurel);

  let controls = new OrbitControls(camera, renderer.domElement);
  controls.enableZoom = true;

  function resize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();

    renderer.setSize(window.innerWidth, window.innerHeight);

    insetWidth = window.innerHeight / 4;
    insetHeight = window.innerHeight / 4;

    cameraTop.aspect = insetWidth / insetHeight;
    cameraTop.updateProjectionMatrix();
  }

  resize();
  window.addEventListener("resize", resize);

  function animate() {
    requestAnimationFrame(animate);

    // The whole viewport
    renderer.setViewport(0, 0, window.innerWidth, window.innerHeight);
    renderer.render(scene, camera);
    renderer.clearDepth();

    renderer.setScissorTest(true);
    
    // The inset one
    const x = window.innerWidth - insetWidth - 16;
    const y = window.innerHeight - insetHeight - 16;
    renderer.setScissor(x, y, insetWidth, insetHeight);
    renderer.setViewport(x, y, insetWidth, insetHeight);

    renderer.render(scene, cameraTop);

    controls.update();
    helper.update();
    renderer.setScissorTest(false);
  }

  animate();
</script>
</body>
</html>
