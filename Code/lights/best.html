<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Shadow</title>
  <!-- https://stackoverflow.com/questions/69817153/three-js-typeerror-material-onbeforerender-is-not-a-function -->
  <link href="/css/main.css" rel="stylesheet">
</head>
<body>

<!-- Three.js -->
<script async src="/es-module-shims-1.3.6/dist/es-module-shims.js"></script>
<script type="importmap">
  {
  	"imports": {
  		"three": "/build/three.module.js"
  	}
  }
</script>

<script type="module">
  import * as THREE from "three";
  import {OrbitControls} from "/jsm/controls/OrbitControls.js";
  import {GLTFLoader} from "/jsm/loaders/GLTFLoader.js";

  // Scene
  let scene = new THREE.Scene();

  // Base camera
  let camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
  camera.position.set(1.2, 1.5, 0.12);
  scene.add(camera);

  // Renderer
  let renderer = new THREE.WebGLRenderer({
    alpha: true
  });

  renderer.setSize(window.innerWidth, window.innerHeight);

  let smallest = Math.min(window.devicePixelRatio, 2);
  renderer.setPixelRatio(smallest); // Makes nice & sharp.
  console.log("%cmin dpr, 2", "color: #ff00cc;", window.devicePixelRatio, smallest);

  renderer.setClearColor(0x151515, 1);
  renderer.shadowMap.enabled = true;
  document.body.appendChild(renderer.domElement);

  // loader
  let loader = new GLTFLoader();
  let imgSrc = "/models/gltf/honda_shadow_rs_2010.glb";
  // let imgSrc = "/models/gltf/box.glb";
  loader.load(imgSrc, function (glb) {
    // console.log("%cglb", "color: #ff00cc;", glb);
    scene.add(glb.scene);
  }, function (xhr) {
    console.log(`${(xhr.loaded / xhr.total) * 100}% loaded`);
  }, function (error) {
    // console.log("An error has occurred");
    console.log(`%c${error.message}`, "color: #ff6a5a;");
  })

  // Lights
  let directionalLight = new THREE.DirectionalLight(0xffffff, 1);
  directionalLight.position.set(2, 2, 5);
  directionalLight.intensity = 1;
  scene.add(directionalLight);

  // let hemisphereLight = new THREE.HemisphereLight( 0xffffbb, 0x080820, 1 ); // soft light
  let hemisphereLight = new THREE.HemisphereLight();
  scene.add(hemisphereLight);

  window.addEventListener("resize", () => {
    // Update camera
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    // Update renderer
    renderer.setSize(window.innerWidth, window.innerHeight);
    // renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
  });

  // Controls
  let controls = new OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;

  // let orbitControl = new OrbitControls(camera, renderer.domElement);
  // orbitControl.update();

  /**
   * Animate
   */
  let clock = new THREE.Clock();

  let tick = () => {
    // let elapsedTime = clock.getElapsedTime();

    // Update objects

    // Update Orbital Controls
    controls.update();

    // Render
    renderer.render(scene, camera);

    // Call tick again on the next frame
    window.requestAnimationFrame(tick);
  };

  tick();
</script>
</body>
</html>
