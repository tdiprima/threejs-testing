<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>threejs-multiple-scenes</title>
  <!-- https://web.archive.org/web/20220929111546/https://r105.threejsfundamentals.org/threejs/lessons/threejs-multiple-scenes.html -->
  <link rel="stylesheet" href="lesson.css">
  <style>
    :root {
      color-scheme: light dark;
      font-size: larger;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="lesson-title">
      <h1>Three.js Multiple Canvases Multiple Scenes</h1>
    </div>
    <div class="lesson">
      <div class="lesson-main">
        <p>A common question is how to use THREE.js with multiple canvases.
  Let's say you want to make an e-commerce site or you want to make
  a page with lots of 3D diagrams. At first glance it appears easy.
  Just make a canvas every where you want a diagram. For each canvas
  make a <a href="https://web.archive.org/web/20220901020046/https://threejs.org/docs/#api/en/constants/Renderer"><code>Renderer</code></a>.</p>
  <p>You'll quickly find though that you run into problems.</p>
  <ol>
  <li><p>The browser limits how many WebGL contexts you can have.</p>
  <p>Typically that limit is around 8 of them. As soon as you create
  the 9th context the oldest one will be lost.</p>
  </li>
  <li><p>WebGL resources can not be shared across contexts</p>
  <p>That means if you want to load a 10 meg model into 2 canvases
  and that model uses 20 meg of textures your 10 meg model will
  have to be loaded twice and your textures will also be loaded
  twice. Nothing can be shared across contexts. This also
  means things have to be intialized twice, shaders compiled twice,
  etc. It gets worse as there are more canvases.</p>
  </li>
  </ol>
  <p>So what's the solution?</p>
  <p>The solution is one canvas that fills the viewport in the background and some other element to represent each "virtual" canvas. We make a single <a href="https://web.archive.org/web/20220901020046/https://threejs.org/docs/#api/en/constants/Renderer"><code>Renderer</code></a> and then one <a href="https://web.archive.org/web/20220901020046/https://threejs.org/docs/#api/en/scenes/Scene"><code>Scene</code></a> for each virtual canvas. We'll then check the positions of the virtual canvas elements and if they are on the screen we'll tell THREE.js to draw their scene at the correct place.</p>
  <p>With this solution there is only 1 canvas so we solve both problem 1
  and 2 above. We won't run into the WebGL context limit because we
  will only be using one context. We also won't run into the sharing
  issues for the same reasons.</p>
  <p>Let's start with a simple example with just 2 scenes. First we'll
  make the HTML</p>
  <pre class="prettyprint showlinemods prettyprinted" style=""><ul class="modifiedlines"><li class=""><span class="tag">&lt;canvas</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"c"</span><span class="tag">&gt;&lt;/canvas&gt;</span></li><li class=""><span class="tag">&lt;p&gt;</span></li><li class=""><span class="pln">  </span><span class="tag">&lt;span</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"box"</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"diagram left"</span><span class="tag">&gt;&lt;/span&gt;</span></li><li class=""><span class="pln">  I love boxes. Presents come in boxes.</span></li><li class=""><span class="pln">  When I find a new box I'm always excited to find out what's inside.</span></li><li class=""><span class="tag">&lt;/p&gt;</span></li><li class=""><span class="tag">&lt;p&gt;</span></li><li class=""><span class="pln">  </span><span class="tag">&lt;span</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"pyramid"</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"diagram right"</span><span class="tag">&gt;&lt;/span&gt;</span></li><li class=""><span class="pln">  When I was a kid I dreamed of going on an expedition inside a pyramid</span></li><li class=""><span class="pln">  and finding a undiscovered tomb full of mummies and treasure.</span></li><li class=""><span class="tag">&lt;/p&gt;</span></li></ul></pre>
  <p>Then we can setup the CSS maybe something like this</p>
  <pre class="prettyprint showlinemods prettyprinted" style=""><ul class="modifiedlines"><li class=""><span class="com">#c {</span></li><li class=""><span class="pln">  position</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">fixed</span><span class="pun">;</span></li><li class=""><span class="pln">  left</span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></li><li class=""><span class="pln">  top</span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></li><li class=""><span class="pln">  width</span><span class="pun">:</span><span class="pln"> </span><span class="lit">100vw</span><span class="pun">;</span></li><li class=""><span class="pln">  height</span><span class="pun">:</span><span class="pln"> </span><span class="lit">100vh</span><span class="pun">;</span></li><li class=""><span class="pln">  display</span><span class="pun">:</span><span class="pln"> block</span><span class="pun">;</span></li><li class=""><span class="pln">  z</span><span class="pun">-</span><span class="pln">index</span><span class="pun">:</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span></li><li class=""><span class="pun">}</span></li><li class=""><span class="pun">.</span><span class="pln">diagram </span><span class="pun">{</span></li><li class=""><span class="pln">  display</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">inline</span><span class="pun">-</span><span class="pln">block</span><span class="pun">;</span></li><li class=""><span class="pln">  width</span><span class="pun">:</span><span class="pln"> </span><span class="lit">5em</span><span class="pun">;</span></li><li class=""><span class="pln">  height</span><span class="pun">:</span><span class="pln"> </span><span class="lit">3em</span><span class="pun">;</span></li><li class=""><span class="pln">  border</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1px</span><span class="pln"> solid black</span><span class="pun">;</span></li><li class=""><span class="pun">}</span></li><li class=""><span class="pun">.</span><span class="pln">left </span><span class="pun">{</span></li><li class=""><span class="pln">  </span><span class="kwd">float</span><span class="pun">:</span><span class="pln"> left</span><span class="pun">;</span></li><li class=""><span class="pln">  margin</span><span class="pun">-</span><span class="pln">right</span><span class="pun">:</span><span class="pln"> </span><span class="pun">.</span><span class="lit">25em</span><span class="pun">;</span></li><li class=""><span class="pun">}</span></li><li class=""><span class="pun">.</span><span class="pln">right </span><span class="pun">{</span></li><li class=""><span class="pln">  </span><span class="kwd">float</span><span class="pun">:</span><span class="pln"> right</span><span class="pun">;</span></li><li class=""><span class="pln">  margin</span><span class="pun">-</span><span class="pln">left</span><span class="pun">:</span><span class="pln"> </span><span class="pun">.</span><span class="lit">25em</span><span class="pun">;</span></li><li class=""><span class="pun">}</span></li></ul></pre>
  <p>We set the canvsas to fill the screen and we set its <code>z-index</code> to
  -1 to make it appear behind other elements. We also need to specify some kind of width and height for our virtual canvas elements since there is nothing inside to give them any size.</p>
  <p>Now we'll make 2 scenes each with a light and a camera.
  To one scene we'll add a cube and to another a diamond.</p>
  <pre class="prettyprint showlinemods prettyprinted" style=""><ul class="modifiedlines"><li class=""><span class="kwd">function</span><span class="pln"> makeScene</span><span class="pun">(</span><span class="pln">elem</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> scene </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">Scene</span><span class="pun">();</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> fov </span><span class="pun">=</span><span class="pln"> </span><span class="lit">45</span><span class="pun">;</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> aspect </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">  </span><span class="com">// the canvas default</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> near </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0.1</span><span class="pun">;</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> far </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5</span><span class="pun">;</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> camera </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">PerspectiveCamera</span><span class="pun">(</span><span class="pln">fov</span><span class="pun">,</span><span class="pln"> aspect</span><span class="pun">,</span><span class="pln"> near</span><span class="pun">,</span><span class="pln"> far</span><span class="pun">);</span></li><li class=""><span class="pln">  camera</span><span class="pun">.</span><span class="pln">position</span><span class="pun">.</span><span class="pln">z </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span></li><li class=""><span class="pln">  camera</span><span class="pun">.</span><span class="pln">position</span><span class="pun">.</span><span class="kwd">set</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">);</span></li><li class=""><span class="pln">  camera</span><span class="pun">.</span><span class="pln">lookAt</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  </span><span class="pun">{</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> color </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0xFFFFFF</span><span class="pun">;</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> intensity </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> light </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">DirectionalLight</span><span class="pun">(</span><span class="pln">color</span><span class="pun">,</span><span class="pln"> intensity</span><span class="pun">);</span></li><li class=""><span class="pln">    light</span><span class="pun">.</span><span class="pln">position</span><span class="pun">.</span><span class="kwd">set</span><span class="pun">(-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">);</span></li><li class=""><span class="pln">    scene</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">light</span><span class="pun">);</span></li><li class=""><span class="pln">  </span><span class="pun">}</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{</span><span class="pln">scene</span><span class="pun">,</span><span class="pln"> camera</span><span class="pun">,</span><span class="pln"> elem</span><span class="pun">};</span></li><li class=""><span class="pun">}</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="kwd">function</span><span class="pln"> setupScene1</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> sceneInfo </span><span class="pun">=</span><span class="pln"> makeScene</span><span class="pun">(</span><span class="pln">document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#box'</span><span class="pun">));</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> geometry </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">BoxBufferGeometry</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> material </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">MeshPhongMaterial</span><span class="pun">({</span><span class="pln">color</span><span class="pun">:</span><span class="pln"> </span><span class="str">'red'</span><span class="pun">});</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> mesh </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">Mesh</span><span class="pun">(</span><span class="pln">geometry</span><span class="pun">,</span><span class="pln"> material</span><span class="pun">);</span></li><li class=""><span class="pln">  sceneInfo</span><span class="pun">.</span><span class="pln">scene</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">mesh</span><span class="pun">);</span></li><li class=""><span class="pln">  sceneInfo</span><span class="pun">.</span><span class="pln">mesh </span><span class="pun">=</span><span class="pln"> mesh</span><span class="pun">;</span></li><li class=""><span class="pln">  </span><span class="kwd">return</span><span class="pln"> sceneInfo</span><span class="pun">;</span></li><li class=""><span class="pun">}</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="kwd">function</span><span class="pln"> setupScene2</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> sceneInfo </span><span class="pun">=</span><span class="pln"> makeScene</span><span class="pun">(</span><span class="pln">document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#pyramid'</span><span class="pun">));</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> radius </span><span class="pun">=</span><span class="pln"> </span><span class="pun">.</span><span class="lit">8</span><span class="pun">;</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> widthSegments </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4</span><span class="pun">;</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> heightSegments </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> geometry </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">SphereBufferGeometry</span><span class="pun">(</span><span class="pln">radius</span><span class="pun">,</span><span class="pln"> widthSegments</span><span class="pun">,</span><span class="pln"> heightSegments</span><span class="pun">);</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> material </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">MeshPhongMaterial</span><span class="pun">({</span></li><li class=""><span class="pln">    color</span><span class="pun">:</span><span class="pln"> </span><span class="str">'blue'</span><span class="pun">,</span></li><li class=""><span class="pln">    flatShading</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span></li><li class=""><span class="pln">  </span><span class="pun">});</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> mesh </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">Mesh</span><span class="pun">(</span><span class="pln">geometry</span><span class="pun">,</span><span class="pln"> material</span><span class="pun">);</span></li><li class=""><span class="pln">  sceneInfo</span><span class="pun">.</span><span class="pln">scene</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">mesh</span><span class="pun">);</span></li><li class=""><span class="pln">  sceneInfo</span><span class="pun">.</span><span class="pln">mesh </span><span class="pun">=</span><span class="pln"> mesh</span><span class="pun">;</span></li><li class=""><span class="pln">  </span><span class="kwd">return</span><span class="pln"> sceneInfo</span><span class="pun">;</span></li><li class=""><span class="pun">}</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="kwd">const</span><span class="pln"> sceneInfo1 </span><span class="pun">=</span><span class="pln"> setupScene1</span><span class="pun">();</span></li><li class=""><span class="kwd">const</span><span class="pln"> sceneInfo2 </span><span class="pun">=</span><span class="pln"> setupScene2</span><span class="pun">();</span></li></ul></pre>
  <p>And then we'll make a function to render each scene
  only if the element is on the screen. We can tell THREE.js
  to only render to part of the canvas by turning on the <em>scissor</em>
  test with <a href="https://web.archive.org/web/20220901020046/https://threejs.org/docs/#api/en/constants/Renderer.setScissorTest"><code>Renderer.setScissorTest</code></a> and then setting both the scissor and the viewport with <a href="https://web.archive.org/web/20220901020046/https://threejs.org/docs/#api/en/constants/Renderer.setViewport"><code>Renderer.setViewport</code></a> and <a href="https://web.archive.org/web/20220901020046/https://threejs.org/docs/#api/en/constants/Renderer.setScissor"><code>Renderer.setScissor</code></a>.</p>
  <pre class="prettyprint showlinemods prettyprinted" style=""><ul class="modifiedlines"><li class=""><span class="kwd">function</span><span class="pln"> rendenerSceneInfo</span><span class="pun">(</span><span class="pln">sceneInfo</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln">scene</span><span class="pun">,</span><span class="pln"> camera</span><span class="pun">,</span><span class="pln"> elem</span><span class="pun">}</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> sceneInfo</span><span class="pun">;</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  </span><span class="com">// get the viewport relative position opf this element</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln">left</span><span class="pun">,</span><span class="pln"> right</span><span class="pun">,</span><span class="pln"> top</span><span class="pun">,</span><span class="pln"> bottom</span><span class="pun">,</span><span class="pln"> width</span><span class="pun">,</span><span class="pln"> height</span><span class="pun">}</span><span class="pln"> </span><span class="pun">=</span></li><li class=""><span class="pln">      elem</span><span class="pun">.</span><span class="pln">getBoundingClientRect</span><span class="pun">();</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> isOffscreen </span><span class="pun">=</span></li><li class=""><span class="pln">      bottom </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">||</span></li><li class=""><span class="pln">      top </span><span class="pun">&gt;</span><span class="pln"> renderer</span><span class="pun">.</span><span class="pln">domElement</span><span class="pun">.</span><span class="pln">clientHeight </span><span class="pun">||</span></li><li class=""><span class="pln">      right </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">||</span></li><li class=""><span class="pln">      left </span><span class="pun">&gt;</span><span class="pln"> renderer</span><span class="pun">.</span><span class="pln">domElement</span><span class="pun">.</span><span class="pln">clientWidth</span><span class="pun">;</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isOffscreen</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">    </span><span class="kwd">return</span><span class="pun">;</span></li><li class=""><span class="pln">  </span><span class="pun">}</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  camera</span><span class="pun">.</span><span class="pln">aspect </span><span class="pun">=</span><span class="pln"> width </span><span class="pun">/</span><span class="pln"> height</span><span class="pun">;</span></li><li class=""><span class="pln">  camera</span><span class="pun">.</span><span class="pln">updateProjectionMatrix</span><span class="pun">();</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> positiveYUpBottom </span><span class="pun">=</span><span class="pln"> canvasRect</span><span class="pun">.</span><span class="pln">height </span><span class="pun">-</span><span class="pln"> bottom</span><span class="pun">;</span></li><li class=""><span class="pln">  renderer</span><span class="pun">.</span><span class="pln">setScissor</span><span class="pun">(</span><span class="pln">left</span><span class="pun">,</span><span class="pln"> positiveYUpBottom</span><span class="pun">,</span><span class="pln"> width</span><span class="pun">,</span><span class="pln"> height</span><span class="pun">);</span></li><li class=""><span class="pln">  renderer</span><span class="pun">.</span><span class="pln">setViewport</span><span class="pun">(</span><span class="pln">left</span><span class="pun">,</span><span class="pln"> positiveYUpBottom</span><span class="pun">,</span><span class="pln"> width</span><span class="pun">,</span><span class="pln"> height</span><span class="pun">);</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  renderer</span><span class="pun">.</span><span class="pln">render</span><span class="pun">(</span><span class="pln">scene</span><span class="pun">,</span><span class="pln"> camera</span><span class="pun">);</span></li><li class=""><span class="pun">}</span></li></ul></pre>
  <p>And then our render function will just first clear the screen
  and then render each scene.</p>
  <pre class="prettyprint showlinemods prettyprinted" style=""><ul class="modifiedlines"><li class=""><span class="kwd">function</span><span class="pln"> render</span><span class="pun">(</span><span class="pln">time</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">  time </span><span class="pun">*=</span><span class="pln"> </span><span class="lit">0.001</span><span class="pun">;</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  resizeRendererToDisplaySize</span><span class="pun">(</span><span class="pln">renderer</span><span class="pun">);</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  renderer</span><span class="pun">.</span><span class="pln">setScissorTest</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span></li><li class=""><span class="pln">  renderer</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">);</span></li><li class=""><span class="pln">  renderer</span><span class="pun">.</span><span class="pln">setScissorTest</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">);</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  sceneInfo1</span><span class="pun">.</span><span class="pln">mesh</span><span class="pun">.</span><span class="pln">rotation</span><span class="pun">.</span><span class="pln">y </span><span class="pun">=</span><span class="pln"> time </span><span class="pun">*</span><span class="pln"> </span><span class="pun">.</span><span class="lit">1</span><span class="pun">;</span></li><li class=""><span class="pln">  sceneInfo2</span><span class="pun">.</span><span class="pln">mesh</span><span class="pun">.</span><span class="pln">rotation</span><span class="pun">.</span><span class="pln">y </span><span class="pun">=</span><span class="pln"> time </span><span class="pun">*</span><span class="pln"> </span><span class="pun">.</span><span class="lit">1</span><span class="pun">;</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  rendenerSceneInfo</span><span class="pun">(</span><span class="pln">sceneInfo1</span><span class="pun">);</span></li><li class=""><span class="pln">  rendenerSceneInfo</span><span class="pun">(</span><span class="pln">sceneInfo2</span><span class="pun">);</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  requestAnimationFrame</span><span class="pun">(</span><span class="pln">render</span><span class="pun">);</span></li><li class=""><span class="pun">}</span></li></ul></pre>
  <p>And here it is</p>
  <p></p><div class="threejs_example_container">
    <div><iframe class="threejs_example" style=" " src="https://r105.threejsfundamentals.org/threejs/resources/editor.html?url=/threejs/lessons/..%2Fthreejs-multiple-scenes-v1.html" data-ruffle-polyfilled=""></iframe></div>
    <a class="threejs_center" href="https://r105.threejsfundamentals.org/threejs/threejs-multiple-scenes-v1.html" target="_blank">click here to open in a separate window</a>
  </div>

  <p></p>
  <p>You can see where the first <code>&lt;span&gt;</code> is there's a red cube and where the second <code>span</code> is there's a blue diamond.</p>
  <h2 id="syncing-up">Syncing up</h2>
  <p>The code above works but there is one minor issue.
  If your scenes are complicated or if for whatever reason
  it takes too long to render, the position of the scenes
  drawn into the canvas will lag behind the rest of the page.</p>
  <p>If we give each area a border </p>
  <pre class="prettyprint showlinemods prettyprinted" style=""><ul class="modifiedlines"><li class=""><span class="pun">.</span><span class="pln">diagram </span><span class="pun">{</span></li><li class=""><span class="pln">  display</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">inline</span><span class="pun">-</span><span class="pln">block</span><span class="pun">;</span></li><li class=""><span class="pln">  width</span><span class="pun">:</span><span class="pln"> </span><span class="lit">5em</span><span class="pun">;</span></li><li class=""><span class="pln">  height</span><span class="pun">:</span><span class="pln"> </span><span class="lit">3em</span><span class="pun">;</span></li><li class="lineadded"><span class="pln">  border</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1px</span><span class="pln"> solid black</span><span class="pun">;</span></li><li class=""><span class="pun">}</span></li></ul></pre>
  <p>And we set the background of each scene</p>
  <pre class="prettyprint showlinemods prettyprinted" style=""><ul class="modifiedlines"><li class=""><span class="kwd">const</span><span class="pln"> scene </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">Scene</span><span class="pun">();</span></li><li class="lineadded"><span class="pln">scene</span><span class="pun">.</span><span class="pln">background </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">Color</span><span class="pun">(</span><span class="str">'red'</span><span class="pun">);</span></li></ul></pre>
  <p>And if we <a href="https://r105.threejsfundamentals.org/threejs/threejs-multiple-scenes-v2.html" target="_blank">quickly scroll up and down</a> we'll see the issue. Here's a animation of scrolling slowed down by 10x.</p>
  <div class="threejs_center"><img class="border" src="https://r105.threejsfundamentals.org/threejs/lessons/resources/images/multi-view-skew.gif"></div>

  <p>We can switch to a different method which has a different tradeoff. We'll switch the canvas's CSS from <code>position: fixed</code> to <code>position: absolute</code>. </p>
  <pre class="prettyprint showlinemods prettyprinted" style=""><ul class="modifiedlines"><li class=""><span class="com">#c {</span></li><li class="linedeleted"><span class="pln">  position</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">fixed</span><span class="pun">;</span></li><li class="lineadded"><span class="pln">  position</span><span class="pun">:</span><span class="pln"> absolute</span><span class="pun">;</span></li></ul></pre>
  <p>Then we'll set the canvas's transform to move it so
  the top of the canvas is at the top of whatever part
  the page is currently scrolled to.</p>
  <pre class="prettyprint showlinemods prettyprinted" style=""><ul class="modifiedlines"><li class=""><span class="kwd">function</span><span class="pln"> render</span><span class="pun">(</span><span class="pln">time</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">  </span><span class="pun">...</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> transform </span><span class="pun">=</span><span class="pln"> </span><span class="str">`translateY(${window.scrollY}px)`</span><span class="pun">;</span></li><li class=""><span class="pln">  renderer</span><span class="pun">.</span><span class="pln">domElement</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">transform </span><span class="pun">=</span><span class="pln"> transform</span><span class="pun">;</span></li></ul></pre>
  <p><code>position: fixed</code> kept the canvas from scrolling at all
  while the rest of the page scrolled over it. <code>position: absolute</code> will let the canvas scroll with the rest of the page which means whatever we draw will stick with the page as it scrolls even if we're too slow to render. When we finally get a chance to render then we move the canvas so it matches where the page has been scrolled and then we re-render. This means only the edges of the window will show some un-rendered bits for a moment but <a href="https://r105.threejsfundamentals.org/threejs/threejs-multiple-scenes-v2.html" target="_blank">the stuff in the middle of the page should match up</a> and not slide. Here's a view of the results of the new method slowed down 10x.</p>
  <div class="threejs_center"><img class="border" src="https://r105.threejsfundamentals.org/threejs/lessons/resources/images/multi-view-fixed.gif"></div>

  <h2 id="making-it-more-generic">Making it more Generic</h2>
  <p>Now that we've gotten multiple scenes working let's make this just slightly more generic.</p>
  <p>We could make it so the main render function, the one managing the canvas, just has a list of elements and their associated render function. For each element it would check if the element is on screen and if so call the corresponding render function. In this way we'd have a generic system where individual scenes aren't really aware they are aware they are being rendered in some smaller space.</p>
  <p>Here's the main render function</p>
  <pre class="prettyprint showlinemods prettyprinted" style=""><ul class="modifiedlines"><li class=""><span class="kwd">const</span><span class="pln"> sceneElements </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span></li><li class=""><span class="kwd">function</span><span class="pln"> addScene</span><span class="pun">(</span><span class="pln">elem</span><span class="pun">,</span><span class="pln"> fn</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">  sceneElements</span><span class="pun">.</span><span class="pln">push</span><span class="pun">({</span><span class="pln">elem</span><span class="pun">,</span><span class="pln"> fn</span><span class="pun">});</span></li><li class=""><span class="pun">}</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="kwd">function</span><span class="pln"> render</span><span class="pun">(</span><span class="pln">time</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">  time </span><span class="pun">*=</span><span class="pln"> </span><span class="lit">0.001</span><span class="pun">;</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  resizeRendererToDisplaySize</span><span class="pun">(</span><span class="pln">renderer</span><span class="pun">);</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  renderer</span><span class="pun">.</span><span class="pln">setScissorTest</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span></li><li class=""><span class="pln">  renderer</span><span class="pun">.</span><span class="pln">setClearColor</span><span class="pun">(</span><span class="pln">clearColor</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span></li><li class=""><span class="pln">  renderer</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">);</span></li><li class=""><span class="pln">  renderer</span><span class="pun">.</span><span class="pln">setScissorTest</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">);</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> transform </span><span class="pun">=</span><span class="pln"> </span><span class="str">`translateY(${window.scrollY}px)`</span><span class="pun">;</span></li><li class=""><span class="pln">  renderer</span><span class="pun">.</span><span class="pln">domElement</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">transform </span><span class="pun">=</span><span class="pln"> transform</span><span class="pun">;</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln">elem</span><span class="pun">,</span><span class="pln"> fn</span><span class="pun">}</span><span class="pln"> of sceneElements</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">    </span><span class="com">// get the viewport relative position opf this element</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> rect </span><span class="pun">=</span><span class="pln"> elem</span><span class="pun">.</span><span class="pln">getBoundingClientRect</span><span class="pun">();</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln">left</span><span class="pun">,</span><span class="pln"> right</span><span class="pun">,</span><span class="pln"> top</span><span class="pun">,</span><span class="pln"> bottom</span><span class="pun">,</span><span class="pln"> width</span><span class="pun">,</span><span class="pln"> height</span><span class="pun">}</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> rect</span><span class="pun">;</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> isOffscreen </span><span class="pun">=</span></li><li class=""><span class="pln">        bottom </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">||</span></li><li class=""><span class="pln">        top </span><span class="pun">&gt;</span><span class="pln"> renderer</span><span class="pun">.</span><span class="pln">domElement</span><span class="pun">.</span><span class="pln">clientHeight </span><span class="pun">||</span></li><li class=""><span class="pln">        right </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">||</span></li><li class=""><span class="pln">        left </span><span class="pun">&gt;</span><span class="pln"> renderer</span><span class="pun">.</span><span class="pln">domElement</span><span class="pun">.</span><span class="pln">clientWidth</span><span class="pun">;</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">isOffscreen</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">      </span><span class="kwd">const</span><span class="pln"> positiveYUpBottom </span><span class="pun">=</span><span class="pln"> renderer</span><span class="pun">.</span><span class="pln">domElement</span><span class="pun">.</span><span class="pln">clientHeight </span><span class="pun">-</span><span class="pln"> bottom</span><span class="pun">;</span></li><li class=""><span class="pln">      renderer</span><span class="pun">.</span><span class="pln">setScissor</span><span class="pun">(</span><span class="pln">left</span><span class="pun">,</span><span class="pln"> positiveYUpBottom</span><span class="pun">,</span><span class="pln"> width</span><span class="pun">,</span><span class="pln"> height</span><span class="pun">);</span></li><li class=""><span class="pln">      renderer</span><span class="pun">.</span><span class="pln">setViewport</span><span class="pun">(</span><span class="pln">left</span><span class="pun">,</span><span class="pln"> positiveYUpBottom</span><span class="pun">,</span><span class="pln"> width</span><span class="pun">,</span><span class="pln"> height</span><span class="pun">);</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">      fn</span><span class="pun">(</span><span class="pln">time</span><span class="pun">,</span><span class="pln"> rect</span><span class="pun">);</span></li><li class=""><span class="pln">    </span><span class="pun">}</span></li><li class=""><span class="pln">  </span><span class="pun">}</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  requestAnimationFrame</span><span class="pun">(</span><span class="pln">render</span><span class="pun">);</span></li><li class=""><span class="pun">}</span></li></ul></pre>
  <p>You can see it loops over <code>sceneElements</code> which it expects is an array of objects each of which have an <code>elem</code> and <code>fn</code> property.</p>
  <p>It checks if the element is on screen. If it is it calls <code>fn</code> and passes it the current time and its rectangle.</p>
  <p>Now the setup code for each scene just adds itself to the list of scenes</p>
  <pre class="prettyprint showlinemods prettyprinted" style=""><ul class="modifiedlines"><li class=""><span class="pun">{</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> elem </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#box'</span><span class="pun">);</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln">scene</span><span class="pun">,</span><span class="pln"> camera</span><span class="pun">}</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> makeScene</span><span class="pun">();</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> geometry </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">BoxBufferGeometry</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> material </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">MeshPhongMaterial</span><span class="pun">({</span><span class="pln">color</span><span class="pun">:</span><span class="pln"> </span><span class="str">'red'</span><span class="pun">});</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> mesh </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">Mesh</span><span class="pun">(</span><span class="pln">geometry</span><span class="pun">,</span><span class="pln"> material</span><span class="pun">);</span></li><li class=""><span class="pln">  scene</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">mesh</span><span class="pun">);</span></li><li class=""><span class="pln">  addScene</span><span class="pun">(</span><span class="pln">elem</span><span class="pun">,</span><span class="pln"> </span><span class="pun">(</span><span class="pln">time</span><span class="pun">,</span><span class="pln"> rect</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">    camera</span><span class="pun">.</span><span class="pln">aspect </span><span class="pun">=</span><span class="pln"> rect</span><span class="pun">.</span><span class="pln">width </span><span class="pun">/</span><span class="pln"> rect</span><span class="pun">.</span><span class="pln">height</span><span class="pun">;</span></li><li class=""><span class="pln">    camera</span><span class="pun">.</span><span class="pln">updateProjectionMatrix</span><span class="pun">();</span></li><li class=""><span class="pln">    mesh</span><span class="pun">.</span><span class="pln">rotation</span><span class="pun">.</span><span class="pln">y </span><span class="pun">=</span><span class="pln"> time </span><span class="pun">*</span><span class="pln"> </span><span class="pun">.</span><span class="lit">1</span><span class="pun">;</span></li><li class=""><span class="pln">    renderer</span><span class="pun">.</span><span class="pln">render</span><span class="pun">(</span><span class="pln">scene</span><span class="pun">,</span><span class="pln"> camera</span><span class="pun">);</span></li><li class=""><span class="pln">  </span><span class="pun">});</span></li><li class=""><span class="pun">}</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pun">{</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> elem </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#pyramid'</span><span class="pun">);</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln">scene</span><span class="pun">,</span><span class="pln"> camera</span><span class="pun">}</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> makeScene</span><span class="pun">();</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> radius </span><span class="pun">=</span><span class="pln"> </span><span class="pun">.</span><span class="lit">8</span><span class="pun">;</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> widthSegments </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4</span><span class="pun">;</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> heightSegments </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> geometry </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">SphereBufferGeometry</span><span class="pun">(</span><span class="pln">radius</span><span class="pun">,</span><span class="pln"> widthSegments</span><span class="pun">,</span><span class="pln"> heightSegments</span><span class="pun">);</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> material </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">MeshPhongMaterial</span><span class="pun">({</span></li><li class=""><span class="pln">    color</span><span class="pun">:</span><span class="pln"> </span><span class="str">'blue'</span><span class="pun">,</span></li><li class=""><span class="pln">    flatShading</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span></li><li class=""><span class="pln">  </span><span class="pun">});</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> mesh </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">Mesh</span><span class="pun">(</span><span class="pln">geometry</span><span class="pun">,</span><span class="pln"> material</span><span class="pun">);</span></li><li class=""><span class="pln">  scene</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">mesh</span><span class="pun">);</span></li><li class=""><span class="pln">  addScene</span><span class="pun">(</span><span class="pln">elem</span><span class="pun">,</span><span class="pln"> </span><span class="pun">(</span><span class="pln">time</span><span class="pun">,</span><span class="pln"> rect</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">    camera</span><span class="pun">.</span><span class="pln">aspect </span><span class="pun">=</span><span class="pln"> rect</span><span class="pun">.</span><span class="pln">width </span><span class="pun">/</span><span class="pln"> rect</span><span class="pun">.</span><span class="pln">height</span><span class="pun">;</span></li><li class=""><span class="pln">    camera</span><span class="pun">.</span><span class="pln">updateProjectionMatrix</span><span class="pun">();</span></li><li class=""><span class="pln">    mesh</span><span class="pun">.</span><span class="pln">rotation</span><span class="pun">.</span><span class="pln">y </span><span class="pun">=</span><span class="pln"> time </span><span class="pun">*</span><span class="pln"> </span><span class="pun">.</span><span class="lit">1</span><span class="pun">;</span></li><li class=""><span class="pln">    renderer</span><span class="pun">.</span><span class="pln">render</span><span class="pun">(</span><span class="pln">scene</span><span class="pun">,</span><span class="pln"> camera</span><span class="pun">);</span></li><li class=""><span class="pln">  </span><span class="pun">});</span></li><li class=""><span class="pun">}</span></li></ul></pre>
  <p>With that we no longer needed <code>sceneInfo1</code> and <code>sceneInfo2</code> and the code that was rotating the meshes is now specific to each scene.</p>
  <p></p><div class="threejs_example_container">
    <div><iframe class="threejs_example" style=" " src="https://r105.threejsfundamentals.org/threejs/resources/editor.html?url=/threejs/lessons/..%2Fthreejs-multiple-scenes-generic.html" data-ruffle-polyfilled=""></iframe></div>
    <a class="threejs_center" href="https://r105.threejsfundamentals.org/threejs/threejs-multiple-scenes-generic.html" target="_blank">click here to open in a separate window</a>
  </div>

  <p></p>
  <h2 id="using-html-dataset">Using HTML Dataset</h2>
  <p>One last even more generic thing we can do is use HTML <a href="https://web.archive.orghttps://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/dataset">dataset</a>. This is a way to add your own data to an HTML element. Instead of using <code>id="..."</code> we'll use <code>data-diagram="..."</code> like this</p>
  <pre class="prettyprint showlinemods prettyprinted" style=""><ul class="modifiedlines"><li class=""><span class="tag">&lt;canvas</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"c"</span><span class="tag">&gt;&lt;/canvas&gt;</span></li><li class=""><span class="tag">&lt;p&gt;</span></li><li class="linedeleted"><span class="pln">  </span><span class="tag">&lt;span</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"box"</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"diagram left"</span><span class="tag">&gt;&lt;/span&gt;</span></li><li class="lineadded"><span class="pln">  </span><span class="tag">&lt;span</span><span class="pln"> </span><span class="atn">data-diagram</span><span class="pun">=</span><span class="atv">"box"</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"left"</span><span class="tag">&gt;&lt;/span&gt;</span></li><li class=""><span class="pln">  I love boxes. Presents come in boxes.</span></li><li class=""><span class="pln">  When I find a new box I'm always excited to find out what's inside.</span></li><li class=""><span class="tag">&lt;/p&gt;</span></li><li class=""><span class="tag">&lt;p&gt;</span></li><li class="linedeleted"><span class="pln">  </span><span class="tag">&lt;span</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"pyramid"</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"diagram left"</span><span class="tag">&gt;&lt;/span&gt;</span></li><li class="lineadded"><span class="pln">  </span><span class="tag">&lt;span</span><span class="pln"> </span><span class="atn">data-diagram</span><span class="pun">=</span><span class="atv">"pyramid"</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"right"</span><span class="tag">&gt;&lt;/span&gt;</span></li><li class=""><span class="pln">  When I was a kid I dreamed of going on an expedition inside a pyramid</span></li><li class=""><span class="pln">  and finding a undiscovered tomb full of mummies and treasure.</span></li><li class=""><span class="tag">&lt;/p&gt;</span></li></ul></pre>
  <p>We can them change the CSS selector to select for that</p>
  <pre class="prettyprint showlinemods prettyprinted" style=""><ul class="modifiedlines"><li class="linedeleted"><span class="pun">.</span><span class="pln">diagram</span></li><li class="lineadded"><span class="pun">*[</span><span class="pln">data</span><span class="pun">-</span><span class="pln">diagram</span><span class="pun">]</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">  display</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">inline</span><span class="pun">-</span><span class="pln">block</span><span class="pun">;</span></li><li class=""><span class="pln">  width</span><span class="pun">:</span><span class="pln"> </span><span class="lit">5em</span><span class="pun">;</span></li><li class=""><span class="pln">  height</span><span class="pun">:</span><span class="pln"> </span><span class="lit">3em</span><span class="pun">;</span></li><li class=""><span class="pun">}</span></li></ul></pre>
  <p>We'll change the scene setup code to just be a map of names to <em>scene initialization functions</em> that return a <em>scene render function</em>.</p>
  <pre class="prettyprint showlinemods prettyprinted" style=""><ul class="modifiedlines"><li class=""><span class="kwd">const</span><span class="pln"> sceneInitFunctionsByName </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">  </span><span class="str">'box'</span><span class="pun">:</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln">scene</span><span class="pun">,</span><span class="pln"> camera</span><span class="pun">}</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> makeScene</span><span class="pun">();</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> geometry </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">BoxBufferGeometry</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> material </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">MeshPhongMaterial</span><span class="pun">({</span><span class="pln">color</span><span class="pun">:</span><span class="pln"> </span><span class="str">'red'</span><span class="pun">});</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> mesh </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">Mesh</span><span class="pun">(</span><span class="pln">geometry</span><span class="pun">,</span><span class="pln"> material</span><span class="pun">);</span></li><li class=""><span class="pln">    scene</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">mesh</span><span class="pun">);</span></li><li class=""><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln">time</span><span class="pun">,</span><span class="pln"> rect</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">      mesh</span><span class="pun">.</span><span class="pln">rotation</span><span class="pun">.</span><span class="pln">y </span><span class="pun">=</span><span class="pln"> time </span><span class="pun">*</span><span class="pln"> </span><span class="pun">.</span><span class="lit">1</span><span class="pun">;</span></li><li class=""><span class="pln">      camera</span><span class="pun">.</span><span class="pln">aspect </span><span class="pun">=</span><span class="pln"> rect</span><span class="pun">.</span><span class="pln">width </span><span class="pun">/</span><span class="pln"> rect</span><span class="pun">.</span><span class="pln">height</span><span class="pun">;</span></li><li class=""><span class="pln">      camera</span><span class="pun">.</span><span class="pln">updateProjectionMatrix</span><span class="pun">();</span></li><li class=""><span class="pln">      renderer</span><span class="pun">.</span><span class="pln">render</span><span class="pun">(</span><span class="pln">scene</span><span class="pun">,</span><span class="pln"> camera</span><span class="pun">);</span></li><li class=""><span class="pln">    </span><span class="pun">};</span></li><li class=""><span class="pln">  </span><span class="pun">},</span></li><li class=""><span class="pln">  </span><span class="str">'pyramid'</span><span class="pun">:</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln">scene</span><span class="pun">,</span><span class="pln"> camera</span><span class="pun">}</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> makeScene</span><span class="pun">();</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> radius </span><span class="pun">=</span><span class="pln"> </span><span class="pun">.</span><span class="lit">8</span><span class="pun">;</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> widthSegments </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4</span><span class="pun">;</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> heightSegments </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> geometry </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">SphereBufferGeometry</span><span class="pun">(</span><span class="pln">radius</span><span class="pun">,</span><span class="pln"> widthSegments</span><span class="pun">,</span><span class="pln"> heightSegments</span><span class="pun">);</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> material </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">MeshPhongMaterial</span><span class="pun">({</span></li><li class=""><span class="pln">      color</span><span class="pun">:</span><span class="pln"> </span><span class="str">'blue'</span><span class="pun">,</span></li><li class=""><span class="pln">      flatShading</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span></li><li class=""><span class="pln">    </span><span class="pun">});</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> mesh </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">Mesh</span><span class="pun">(</span><span class="pln">geometry</span><span class="pun">,</span><span class="pln"> material</span><span class="pun">);</span></li><li class=""><span class="pln">    scene</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">mesh</span><span class="pun">);</span></li><li class=""><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln">time</span><span class="pun">,</span><span class="pln"> rect</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">      mesh</span><span class="pun">.</span><span class="pln">rotation</span><span class="pun">.</span><span class="pln">y </span><span class="pun">=</span><span class="pln"> time </span><span class="pun">*</span><span class="pln"> </span><span class="pun">.</span><span class="lit">1</span><span class="pun">;</span></li><li class=""><span class="pln">      camera</span><span class="pun">.</span><span class="pln">aspect </span><span class="pun">=</span><span class="pln"> rect</span><span class="pun">.</span><span class="pln">width </span><span class="pun">/</span><span class="pln"> rect</span><span class="pun">.</span><span class="pln">height</span><span class="pun">;</span></li><li class=""><span class="pln">      camera</span><span class="pun">.</span><span class="pln">updateProjectionMatrix</span><span class="pun">();</span></li><li class=""><span class="pln">      renderer</span><span class="pun">.</span><span class="pln">render</span><span class="pun">(</span><span class="pln">scene</span><span class="pun">,</span><span class="pln"> camera</span><span class="pun">);</span></li><li class=""><span class="pln">    </span><span class="pun">};</span></li><li class=""><span class="pln">  </span><span class="pun">},</span></li><li class=""><span class="pun">};</span></li></ul></pre>
  <p>And to init we can just use <code>querySelectorAll</code> to find all the diagrams and call the corresponding init function for that diagram. </p>
  <pre class="prettyprint showlinemods prettyprinted" style=""><ul class="modifiedlines"><li class=""><span class="pln">document</span><span class="pun">.</span><span class="pln">querySelectorAll</span><span class="pun">(</span><span class="str">'[data-diagram]'</span><span class="pun">).</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">elem</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> sceneName </span><span class="pun">=</span><span class="pln"> elem</span><span class="pun">.</span><span class="pln">dataset</span><span class="pun">.</span><span class="pln">diagram</span><span class="pun">;</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> sceneInitFunction </span><span class="pun">=</span><span class="pln"> sceneInitFunctionsByName</span><span class="pun">[</span><span class="pln">sceneName</span><span class="pun">];</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> sceneRenderFunction </span><span class="pun">=</span><span class="pln"> sceneInitFunction</span><span class="pun">(</span><span class="pln">elem</span><span class="pun">);</span></li><li class=""><span class="pln">  addScene</span><span class="pun">(</span><span class="pln">elem</span><span class="pun">,</span><span class="pln"> sceneRenderFunction</span><span class="pun">());</span></li><li class=""><span class="pun">});</span></li></ul></pre>
  <p>No change to the visuals but the code is even more generic.</p>
  <p></p>
  <h2 id="adding-controls-to-each-element">Adding Controls to each element</h2>
  <p>Adding interactively, for example a <code>TrackballControls</code> is just as easy. First we add the script for the control.</p>
  <pre class="prettyprint showlinemods prettyprinted" style=""><ul class="modifiedlines"><li class=""><span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"resources/threejs/r105/js/controls/TrackballControls.js"</span><span class="tag">&gt;&lt;/script&gt;</span></li></ul></pre>
  <p>And then we can add a <code>TrackballControls</code> to each scene passing in the element associated with that scene.</p>
  <pre class="prettyprint showlinemods prettyprinted" style=""><ul class="modifiedlines"><li class="linedeleted"><span class="kwd">function</span><span class="pln"> makeScene</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></li><li class="lineadded"><span class="kwd">function</span><span class="pln"> makeScene</span><span class="pun">(</span><span class="pln">elem</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> scene </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">Scene</span><span class="pun">();</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> fov </span><span class="pun">=</span><span class="pln"> </span><span class="lit">45</span><span class="pun">;</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> aspect </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">  </span><span class="com">// the canvas default</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> near </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0.1</span><span class="pun">;</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> far </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5</span><span class="pun">;</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> camera </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">PerspectiveCamera</span><span class="pun">(</span><span class="pln">fov</span><span class="pun">,</span><span class="pln"> aspect</span><span class="pun">,</span><span class="pln"> near</span><span class="pun">,</span><span class="pln"> far</span><span class="pun">);</span></li><li class=""><span class="pln">  camera</span><span class="pun">.</span><span class="pln">position</span><span class="pun">.</span><span class="kwd">set</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">);</span></li><li class=""><span class="pln">  camera</span><span class="pun">.</span><span class="pln">lookAt</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span></li><li class="lineadded"><span class="pln">  scene</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">camera</span><span class="pun">);</span></li><li class=""><span class="pln">&nbsp;</span></li><li class="lineadded"><span class="pln">  </span><span class="kwd">const</span><span class="pln"> controls </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">TrackballControls</span><span class="pun">(</span><span class="pln">camera</span><span class="pun">,</span><span class="pln"> elem</span><span class="pun">);</span></li><li class="lineadded"><span class="pln">  controls</span><span class="pun">.</span><span class="pln">noZoom </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></li><li class="lineadded"><span class="pln">  controls</span><span class="pun">.</span><span class="pln">noPan </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  </span><span class="pun">{</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> color </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0xFFFFFF</span><span class="pun">;</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> intensity </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> light </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">DirectionalLight</span><span class="pun">(</span><span class="pln">color</span><span class="pun">,</span><span class="pln"> intensity</span><span class="pun">);</span></li><li class=""><span class="pln">    light</span><span class="pun">.</span><span class="pln">position</span><span class="pun">.</span><span class="kwd">set</span><span class="pun">(-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">);</span></li><li class="linedeleted"><span class="pln">    scene</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">light</span><span class="pun">);</span></li><li class="lineadded"><span class="pln">    camera</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">light</span><span class="pun">);</span></li><li class=""><span class="pln">  </span><span class="pun">}</span></li><li class=""><span class="pln">&nbsp;</span></li><li class="linedeleted"><span class="pln">  </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{</span><span class="pln">scene</span><span class="pun">,</span><span class="pln"> camera</span><span class="pun">};</span></li><li class="lineadded"><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{</span><span class="pln">scene</span><span class="pun">,</span><span class="pln"> camera</span><span class="pun">,</span><span class="pln"> controls</span><span class="pun">};</span></li><li class=""><span class="pun">}</span></li></ul></pre>
  <p>You'll notice we added the camera to the scene and the light to the camera. This makes the light relative to the camera. Since the <code>TrackballControls</code> are moving the camera this is probably what we want. It keeps the light shining on the side of the object we are looking at.</p>
  <p>We need up update those controls in our render functions</p>
  <pre class="prettyprint showlinemods prettyprinted" style=""><ul class="modifiedlines"><li class=""><span class="kwd">const</span><span class="pln"> sceneInitFunctionsByName </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></li><li class="linedeleted"><span class="pln"> </span><span class="str">'box'</span><span class="pun">:</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span></li><li class="linedeleted"><span class="pln">    </span><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln">scene</span><span class="pun">,</span><span class="pln"> camera</span><span class="pun">}</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> makeScene</span><span class="pun">();</span></li><li class="lineadded"><span class="pln"> </span><span class="str">'box'</span><span class="pun">:</span><span class="pln"> </span><span class="pun">(</span><span class="pln">elem</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span></li><li class="lineadded"><span class="pln">    </span><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln">scene</span><span class="pun">,</span><span class="pln"> camera</span><span class="pun">,</span><span class="pln"> controls</span><span class="pun">}</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> makeScene</span><span class="pun">(</span><span class="pln">elem</span><span class="pun">);</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> geometry </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">BoxBufferGeometry</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> material </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">MeshPhongMaterial</span><span class="pun">({</span><span class="pln">color</span><span class="pun">:</span><span class="pln"> </span><span class="str">'red'</span><span class="pun">});</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> mesh </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">Mesh</span><span class="pun">(</span><span class="pln">geometry</span><span class="pun">,</span><span class="pln"> material</span><span class="pun">);</span></li><li class=""><span class="pln">    scene</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">mesh</span><span class="pun">);</span></li><li class=""><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln">time</span><span class="pun">,</span><span class="pln"> rect</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">      mesh</span><span class="pun">.</span><span class="pln">rotation</span><span class="pun">.</span><span class="pln">y </span><span class="pun">=</span><span class="pln"> time </span><span class="pun">*</span><span class="pln"> </span><span class="pun">.</span><span class="lit">1</span><span class="pun">;</span></li><li class=""><span class="pln">      camera</span><span class="pun">.</span><span class="pln">aspect </span><span class="pun">=</span><span class="pln"> rect</span><span class="pun">.</span><span class="pln">width </span><span class="pun">/</span><span class="pln"> rect</span><span class="pun">.</span><span class="pln">height</span><span class="pun">;</span></li><li class=""><span class="pln">      camera</span><span class="pun">.</span><span class="pln">updateProjectionMatrix</span><span class="pun">();</span></li><li class="lineadded"><span class="pln">      controls</span><span class="pun">.</span><span class="pln">handleResize</span><span class="pun">();</span></li><li class="lineadded"><span class="pln">      controls</span><span class="pun">.</span><span class="pln">update</span><span class="pun">();</span></li><li class=""><span class="pln">      renderer</span><span class="pun">.</span><span class="pln">render</span><span class="pun">(</span><span class="pln">scene</span><span class="pun">,</span><span class="pln"> camera</span><span class="pun">);</span></li><li class=""><span class="pln">    </span><span class="pun">};</span></li><li class=""><span class="pln">  </span><span class="pun">},</span></li><li class="linedeleted"><span class="pln">  </span><span class="str">'pyramid'</span><span class="pun">:</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span></li><li class="linedeleted"><span class="pln">    </span><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln">scene</span><span class="pun">,</span><span class="pln"> camera</span><span class="pun">}</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> makeScene</span><span class="pun">();</span></li><li class="lineadded"><span class="pln">  </span><span class="str">'pyramid'</span><span class="pun">:</span><span class="pln"> </span><span class="pun">(</span><span class="pln">elem</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span></li><li class="lineadded"><span class="pln">    </span><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln">scene</span><span class="pun">,</span><span class="pln"> camera</span><span class="pun">,</span><span class="pln"> controls</span><span class="pun">}</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> makeScene</span><span class="pun">(</span><span class="pln">elem</span><span class="pun">);</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> radius </span><span class="pun">=</span><span class="pln"> </span><span class="pun">.</span><span class="lit">8</span><span class="pun">;</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> widthSegments </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4</span><span class="pun">;</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> heightSegments </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> geometry </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">SphereBufferGeometry</span><span class="pun">(</span><span class="pln">radius</span><span class="pun">,</span><span class="pln"> widthSegments</span><span class="pun">,</span><span class="pln"> heightSegments</span><span class="pun">);</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> material </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">MeshPhongMaterial</span><span class="pun">({</span></li><li class=""><span class="pln">      color</span><span class="pun">:</span><span class="pln"> </span><span class="str">'blue'</span><span class="pun">,</span></li><li class=""><span class="pln">      flatShading</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span></li><li class=""><span class="pln">    </span><span class="pun">});</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> mesh </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">Mesh</span><span class="pun">(</span><span class="pln">geometry</span><span class="pun">,</span><span class="pln"> material</span><span class="pun">);</span></li><li class=""><span class="pln">    scene</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">mesh</span><span class="pun">);</span></li><li class=""><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln">time</span><span class="pun">,</span><span class="pln"> rect</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">      mesh</span><span class="pun">.</span><span class="pln">rotation</span><span class="pun">.</span><span class="pln">y </span><span class="pun">=</span><span class="pln"> time </span><span class="pun">*</span><span class="pln"> </span><span class="pun">.</span><span class="lit">1</span><span class="pun">;</span></li><li class=""><span class="pln">      camera</span><span class="pun">.</span><span class="pln">aspect </span><span class="pun">=</span><span class="pln"> rect</span><span class="pun">.</span><span class="pln">width </span><span class="pun">/</span><span class="pln"> rect</span><span class="pun">.</span><span class="pln">height</span><span class="pun">;</span></li><li class=""><span class="pln">      camera</span><span class="pun">.</span><span class="pln">updateProjectionMatrix</span><span class="pun">();</span></li><li class="lineadded"><span class="pln">      controls</span><span class="pun">.</span><span class="pln">handleResize</span><span class="pun">();</span></li><li class="lineadded"><span class="pln">      controls</span><span class="pun">.</span><span class="pln">update</span><span class="pun">();</span></li><li class=""><span class="pln">      renderer</span><span class="pun">.</span><span class="pln">render</span><span class="pun">(</span><span class="pln">scene</span><span class="pun">,</span><span class="pln"> camera</span><span class="pun">);</span></li><li class=""><span class="pln">    </span><span class="pun">};</span></li><li class=""><span class="pln">  </span><span class="pun">},</span></li><li class=""><span class="pun">};</span></li></ul></pre>
  <p>And now if you drag the objects they'll rotate.</p>
  <p></p><div class="threejs_example_container">
    <div><iframe class="threejs_example" style=" " src="https://r105.threejsfundamentals.org/threejs/resources/editor.html?url=/threejs/lessons/..%2Fthreejs-multiple-scenes-controls.html" data-ruffle-polyfilled=""></iframe></div>
    <a class="threejs_center" href="https://r105.threejsfundamentals.org/threejs/threejs-multiple-scenes-controls.html" target="_blank">click here to open in a separate window</a>
  </div>

  <p></p>
  <p>These techniques are used on this site itself. In particular <a href="threejs-primitives.html">the article about primitives</a> and <a href="threejs-materials.html">the article about materials</a> use this technique to add the various examples throughout the article.</p>
  <p>One more solution would be to render to an off screen canvas and copy the result to a 2D canvas at each element.
  The advantage to this solution is there is no limit on how you can composite each separate area. With the previous
  solution we and a single canvas in the background. With this solution we have normal HTML elements.</p>
  <p>The disadvantage is it's slower because a copy has to happen for each area. How much slower depends on the browser
  and the GPU.</p>
  <p>The changes needed are pretty small</p>
  <p>First we'll change HTML as we no longer need a canvas in the page</p>
  <pre class="prettyprint showlinemods prettyprinted" style=""><ul class="modifiedlines"><li class=""><span class="tag">&lt;body&gt;</span></li><li class="linedeleted"><span class="pln">  </span><span class="tag">&lt;canvas</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"c"</span><span class="tag">&gt;&lt;/canvas&gt;</span></li><li class=""><span class="pln">  ...</span></li><li class=""><span class="tag">&lt;/body&gt;</span></li></ul></pre>
  <p>then we'll change the CSS</p>
  <pre class="prettyprint showlinemods prettyprinted" style=""><ul class="modifiedlines"><li class="linedeleted"><span class="com">#c {</span></li><li class="linedeleted"><span class="pln">  position</span><span class="pun">:</span><span class="pln"> absolute</span><span class="pun">;</span></li><li class="linedeleted"><span class="pln">  left</span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></li><li class="linedeleted"><span class="pln">  top</span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></li><li class="linedeleted"><span class="pln">  width</span><span class="pun">:</span><span class="pln"> </span><span class="lit">100vw</span><span class="pun">;</span></li><li class="linedeleted"><span class="pln">  height</span><span class="pun">:</span><span class="pln"> </span><span class="lit">100vh</span><span class="pun">;</span></li><li class="linedeleted"><span class="pln">  display</span><span class="pun">:</span><span class="pln"> block</span><span class="pun">;</span></li><li class="linedeleted"><span class="pln">  z</span><span class="pun">-</span><span class="pln">index</span><span class="pun">:</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span></li><li class="linedeleted"><span class="pun">}</span></li><li class=""><span class="pln">canvas </span><span class="pun">{</span></li><li class=""><span class="pln">  width</span><span class="pun">:</span><span class="pln"> </span><span class="lit">100</span><span class="pun">%;</span></li><li class=""><span class="pln">  height</span><span class="pun">:</span><span class="pln"> </span><span class="lit">100</span><span class="pun">%;</span></li><li class=""><span class="pln">  display</span><span class="pun">:</span><span class="pln"> block</span><span class="pun">;</span></li><li class=""><span class="pun">}</span></li><li class="linemodified"><span class="pun">[</span><span class="pln">data</span><span class="pun">-</span><span class="pln">diagram</span><span class="pun">]</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">  display</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">inline</span><span class="pun">-</span><span class="pln">block</span><span class="pun">;</span></li><li class=""><span class="pln">  width</span><span class="pun">:</span><span class="pln"> </span><span class="lit">5em</span><span class="pun">;</span></li><li class=""><span class="pln">  height</span><span class="pun">:</span><span class="pln"> </span><span class="lit">3em</span><span class="pun">;</span></li><li class=""><span class="pun">}</span></li></ul></pre><p>We've made all canvases fill their container.</p>
  <p>Now let's change the JavaScript. First we no longer
  look up the canvas. Instead we create one. We also
  just turn on the scissor test at the beginning.</p>
  <pre class="prettyprint showlinemods prettyprinted" style=""><ul class="modifiedlines"><li class=""><span class="kwd">function</span><span class="pln"> main</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></li><li class="linedeleted"><span class="pln">  </span><span class="kwd">const</span><span class="pln"> canvas </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#c'</span><span class="pun">);</span></li><li class="lineadded"><span class="pln">  </span><span class="kwd">const</span><span class="pln"> canvas </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">createElement</span><span class="pun">(</span><span class="str">'canvas'</span><span class="pun">);</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> renderer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">WebGLRenderer</span><span class="pun">({</span><span class="pln">canvas</span><span class="pun">,</span><span class="pln"> alpha</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">});</span></li><li class="lineadded"><span class="pln">  renderer</span><span class="pun">.</span><span class="pln">setScissorTest</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">);</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  </span><span class="pun">...</span></li></ul></pre>
  <p>Then for each scene we create a 2D rendering context and
  append its canvas to the element for that scene</p>
  <pre class="prettyprint showlinemods prettyprinted" style=""><ul class="modifiedlines"><li class=""><span class="kwd">const</span><span class="pln"> sceneElements </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span></li><li class=""><span class="kwd">function</span><span class="pln"> addScene</span><span class="pun">(</span><span class="pln">elem</span><span class="pun">,</span><span class="pln"> fn</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="lineadded"><span class="pln">  </span><span class="kwd">const</span><span class="pln"> ctx </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">createElement</span><span class="pun">(</span><span class="str">'canvas'</span><span class="pun">).</span><span class="pln">getContext</span><span class="pun">(</span><span class="str">'2d'</span><span class="pun">);</span></li><li class="lineadded"><span class="pln">  elem</span><span class="pun">.</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">ctx</span><span class="pun">.</span><span class="pln">canvas</span><span class="pun">);</span></li><li class="linedeleted"><span class="pln">  sceneElements</span><span class="pun">.</span><span class="pln">push</span><span class="pun">({</span><span class="pln">elem</span><span class="pun">,</span><span class="pln"> fn</span><span class="pun">});</span></li><li class="lineadded"><span class="pln">  sceneElements</span><span class="pun">.</span><span class="pln">push</span><span class="pun">({</span><span class="pln">elem</span><span class="pun">,</span><span class="pln"> ctx</span><span class="pun">,</span><span class="pln"> fn</span><span class="pun">});</span></li><li class=""><span class="pun">}</span></li></ul></pre>
  <p>Then when rendering, if the renderer's canvas is not
  big enough to render this area we increase its size.
  As well if this area's canvas is the wrong size we
  change its size. Finally we set the scissor and viewport,
  render the scene for this area, then copy the result to the area's canvas.</p>
  <pre class="prettyprint showlinemods prettyprinted" style=""><ul class="modifiedlines"><li class=""><span class="kwd">function</span><span class="pln"> render</span><span class="pun">(</span><span class="pln">time</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">  time </span><span class="pun">*=</span><span class="pln"> </span><span class="lit">0.001</span><span class="pun">;</span></li><li class=""><span class="pln">&nbsp;</span></li><li class="linedeleted"><span class="pln">  resizeRendererToDisplaySize</span><span class="pun">(</span><span class="pln">renderer</span><span class="pun">);</span></li><li class="linedeleted"><span class="pln"> </span></li><li class="linedeleted"><span class="pln">  renderer</span><span class="pun">.</span><span class="pln">setScissorTest</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span></li><li class="linedeleted"><span class="pln">  renderer</span><span class="pun">.</span><span class="pln">setClearColor</span><span class="pun">(</span><span class="pln">clearColor</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span></li><li class="linedeleted"><span class="pln">  renderer</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">);</span></li><li class="linedeleted"><span class="pln">  renderer</span><span class="pun">.</span><span class="pln">setScissorTest</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">);</span></li><li class="linedeleted"><span class="pln"> </span></li><li class="linedeleted"><span class="pln">  </span><span class="kwd">const</span><span class="pln"> transform </span><span class="pun">=</span><span class="pln"> </span><span class="str">`translateY(${window.scrollY}px)`</span><span class="pun">;</span></li><li class="linedeleted"><span class="pln">  renderer</span><span class="pun">.</span><span class="pln">domElement</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">transform </span><span class="pun">=</span><span class="pln"> transform</span><span class="pun">;</span></li><li class=""><span class="pln">&nbsp;</span></li><li class="linedeleted"><span class="pln">  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln">elem</span><span class="pun">,</span><span class="pln"> fn</span><span class="pun">}</span><span class="pln"> of sceneElements</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="lineadded"><span class="pln">  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln">elem</span><span class="pun">,</span><span class="pln"> fn</span><span class="pun">,</span><span class="pln"> ctx</span><span class="pun">}</span><span class="pln"> of sceneElements</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">    </span><span class="com">// get the viewport relative position opf this element</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> rect </span><span class="pun">=</span><span class="pln"> elem</span><span class="pun">.</span><span class="pln">getBoundingClientRect</span><span class="pun">();</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln">left</span><span class="pun">,</span><span class="pln"> right</span><span class="pun">,</span><span class="pln"> top</span><span class="pun">,</span><span class="pln"> bottom</span><span class="pun">,</span><span class="pln"> width</span><span class="pun">,</span><span class="pln"> height</span><span class="pun">}</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> rect</span><span class="pun">;</span></li><li class="lineadded"><span class="pln">    </span><span class="kwd">const</span><span class="pln"> rendererCanvas </span><span class="pun">=</span><span class="pln"> renderer</span><span class="pun">.</span><span class="pln">domElement</span><span class="pun">;</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> isOffscreen </span><span class="pun">=</span></li><li class=""><span class="pln">        bottom </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">||</span></li><li class="linedeleted"><span class="pln">        top </span><span class="pun">&gt;</span><span class="pln"> renderer</span><span class="pun">.</span><span class="pln">domElement</span><span class="pun">.</span><span class="pln">clientHeight </span><span class="pun">||</span></li><li class="lineadded"><span class="pln">        top </span><span class="pun">&gt;</span><span class="pln"> window</span><span class="pun">.</span><span class="pln">innerHeight </span><span class="pun">||</span></li><li class=""><span class="pln">        right </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">||</span></li><li class="linedeleted"><span class="pln">        left </span><span class="pun">&gt;</span><span class="pln"> renderer</span><span class="pun">.</span><span class="pln">domElement</span><span class="pun">.</span><span class="pln">clientWidth</span><span class="pun">;</span></li><li class="lineadded"><span class="pln">        left </span><span class="pun">&gt;</span><span class="pln"> window</span><span class="pun">.</span><span class="pln">innerWidth</span><span class="pun">;</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">isOffscreen</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="linedeleted"><span class="pln">      </span><span class="kwd">const</span><span class="pln"> positiveYUpBottom </span><span class="pun">=</span><span class="pln"> renderer</span><span class="pun">.</span><span class="pln">domElement</span><span class="pun">.</span><span class="pln">clientHeight </span><span class="pun">-</span><span class="pln"> bottom</span><span class="pun">;</span></li><li class="linedeleted"><span class="pln">      renderer</span><span class="pun">.</span><span class="pln">setScissor</span><span class="pun">(</span><span class="pln">left</span><span class="pun">,</span><span class="pln"> positiveYUpBottom</span><span class="pun">,</span><span class="pln"> width</span><span class="pun">,</span><span class="pln"> height</span><span class="pun">);</span></li><li class="linedeleted"><span class="pln">      renderer</span><span class="pun">.</span><span class="pln">setViewport</span><span class="pun">(</span><span class="pln">left</span><span class="pun">,</span><span class="pln"> positiveYUpBottom</span><span class="pun">,</span><span class="pln"> width</span><span class="pun">,</span><span class="pln"> height</span><span class="pun">);</span></li><li class=""><span class="pln">&nbsp;</span></li><li class="lineadded"><span class="pln">      </span><span class="com">// make sure the renderer's canvas is big enough</span></li><li class="lineadded"><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">rendererCanvas</span><span class="pun">.</span><span class="pln">width </span><span class="pun">&lt;</span><span class="pln"> width </span><span class="pun">||</span><span class="pln"> rendererCanvas</span><span class="pun">.</span><span class="pln">height </span><span class="pun">&lt;</span><span class="pln"> height</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="lineadded"><span class="pln">        renderer</span><span class="pun">.</span><span class="pln">setSize</span><span class="pun">(</span><span class="pln">width</span><span class="pun">,</span><span class="pln"> height</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span></li><li class="lineadded"><span class="pln">      </span><span class="pun">}</span></li><li class="lineadded"><span class="pln"> </span></li><li class="lineadded"><span class="pln">      </span><span class="com">// make sure the canvas for this area is the same size as the area</span></li><li class="lineadded"><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ctx</span><span class="pun">.</span><span class="pln">canvas</span><span class="pun">.</span><span class="pln">width </span><span class="pun">!==</span><span class="pln"> width </span><span class="pun">||</span><span class="pln"> ctx</span><span class="pun">.</span><span class="pln">canvas</span><span class="pun">.</span><span class="pln">height </span><span class="pun">!==</span><span class="pln"> height</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="lineadded"><span class="pln">        ctx</span><span class="pun">.</span><span class="pln">canvas</span><span class="pun">.</span><span class="pln">width </span><span class="pun">=</span><span class="pln"> width</span><span class="pun">;</span></li><li class="lineadded"><span class="pln">        ctx</span><span class="pun">.</span><span class="pln">canvas</span><span class="pun">.</span><span class="pln">height </span><span class="pun">=</span><span class="pln"> height</span><span class="pun">;</span></li><li class="lineadded"><span class="pln">      </span><span class="pun">}</span></li><li class="lineadded"><span class="pln"> </span></li><li class="lineadded"><span class="pln">      renderer</span><span class="pun">.</span><span class="pln">setScissor</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> width</span><span class="pun">,</span><span class="pln"> height</span><span class="pun">);</span></li><li class="lineadded"><span class="pln">      renderer</span><span class="pun">.</span><span class="pln">setViewport</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> width</span><span class="pun">,</span><span class="pln"> height</span><span class="pun">);</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">      fn</span><span class="pun">(</span><span class="pln">time</span><span class="pun">,</span><span class="pln"> rect</span><span class="pun">);</span></li><li class=""><span class="pln">&nbsp;</span></li><li class="lineadded"><span class="pln">      </span><span class="com">// copy the rendered scene to this element's canvas</span></li><li class="lineadded"><span class="pln">      ctx</span><span class="pun">.</span><span class="pln">globalCompositeOperation </span><span class="pun">=</span><span class="pln"> </span><span class="str">'copy'</span><span class="pun">;</span></li><li class="lineadded"><span class="pln">      ctx</span><span class="pun">.</span><span class="pln">drawImage</span><span class="pun">(</span></li><li class="lineadded"><span class="pln">          rendererCanvas</span><span class="pun">,</span></li><li class="lineadded"><span class="pln">          </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> rendererCanvas</span><span class="pun">.</span><span class="pln">height </span><span class="pun">-</span><span class="pln"> height</span><span class="pun">,</span><span class="pln"> width</span><span class="pun">,</span><span class="pln"> height</span><span class="pun">,</span><span class="pln">  </span><span class="com">// src rect</span></li><li class="lineadded"><span class="pln">          </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> width</span><span class="pun">,</span><span class="pln"> height</span><span class="pun">);</span><span class="pln">                              </span><span class="com">// dst rect</span></li><li class=""><span class="pln">    </span><span class="pun">}</span></li><li class=""><span class="pln">  </span><span class="pun">}</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  requestAnimationFrame</span><span class="pun">(</span><span class="pln">render</span><span class="pun">);</span></li><li class=""><span class="pun">}</span></li></ul></pre>
  <p>The result looks the same</p>
  <p></p><div class="threejs_example_container">
    <div><iframe class="threejs_example" style=" " src="https://r105.threejsfundamentals.org/threejs/resources/editor.html?url=/threejs/lessons/..%2Fthreejs-multiple-scenes-copy-canvas.html" data-ruffle-polyfilled=""></iframe></div>
    <a class="threejs_center" href="https://r105.threejsfundamentals.org/threejs/threejs-multiple-scenes-copy-canvas.html" target="_blank">click here to open in a separate window</a>
  </div>

  <p></p>
  <p>One other advantage to this solution is you could potentially use
  <a href="https://web.archive.orghttps://developer.mozilla.org/en-US/docs/Web/API/OffscreenCanvas"><code>OffscreenCanvas</code></a>
  to render from a web worker and still use this technique. Unfortunately as of April 2019
  <code>OffscreenCanvas</code> is only supported by Chrome.</p>

      </div>
      <div class="lesson-sidebar">
          <select class="language">
      <option value="/threejs/lessons/threejs-multiple-scenes.html" selected="">English
      </option><option value="/threejs/lessons/ru/threejs-multiple-scenes.html">Русский
      </option><option value="/threejs/lessons/zh_cn/threejs-multiple-scenes.html">中文
  </option></select>


          <div id="toc">
            <ul>  <li>Basics</li>
          <ul>
            <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-fundamentals.html">Fundamentals</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-responsive.html">Responsive Design</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-prerequisites.html">Prerequisites</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-setup.html">Setup</a></li>
          </ul>
    <li>Solutions</li>
          <ul>
            <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-load-obj.html">Load an .OBJ file</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-load-gltf.html">Load a .GLTF file</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-backgrounds.html">Add a Background or Skybox</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-transparency.html">How to Draw Transparent Objects</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-multiple-scenes.html">Multiple Canvases, Multiple Scenes</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-picking.html">Picking Objects with the mouse</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-post-processing.html">Post Processing</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-post-processing-3dlut.html">Applying a LUT File for effects</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-shadertoy.html">Using Shadertoy shaders</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-align-html-elements-to-3d.html">Aligning HTML Elements to 3D</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-indexed-textures.html">Using Indexed Textures for Picking and Color</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-canvas-textures.html">Using A Canvas for Dynamic Textures</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-billboards.html">Billboards and Facades</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-cleanup.html">Freeing Resources</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-voxel-geometry.html">Making Voxel Geometry (Minecraft)</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-game.html">Start making a Game.</a></li>
          </ul>
    <li>WebVR</li>
          <ul>
            <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-webvr.html">WebVR - Basics</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-webvr-look-to-select.html">WebVR - Look To Select</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-webvr-point-to-select.html">WebVR - Point To Select</a></li>
          </ul>
    <li>Optimization</li>
          <ul>
            <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-optimize-lots-of-objects.html">Optimizing Lots of Objects</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-optimize-lots-of-objects-animated.html">Optimizing Lots of Objects Animated</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-offscreencanvas.html">Using OffscreenCanvas in a Web Worker</a></li>
          </ul>
    <li>Tips</li>
          <ul>
            <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-rendering-on-demand.html">Rendering On Demand</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-debugging-javascript.html">Debugging JavaScript</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-debugging-glsl.html">Debugging GLSL</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-tips.html#screenshot">Taking a screenshot</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-tips.html#preservedrawingbuffer">Prevent the Canvas Being Cleared</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-tips.html#tabindex">Get Keyboard Input From a Canvas</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-tips.html#transparent-canvas">Make the Canvas Transparent</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-tips.html#html-background">Use three.js as Background in HTML</a></li>
          </ul>
    <li>Fundamentals</li>
          <ul>
            <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-primitives.html">Primitives</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-scenegraph.html">Scenegraph</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-materials.html">Materials</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-textures.html">Textures</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-lights.html">Lights</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-cameras.html">Cameras</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-shadows.html">Shadows</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-fog.html">Fog</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-rendertargets.html">Render Targets</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-custom-geometry.html">Custom Geometry</a></li>
  <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-custom-buffergeometry.html">Custom BufferGeometry</a></li>
          </ul>
    <li>Reference</li>
          <ul>
            <li><a href="https://r105.threejsfundamentals.org/threejs/lessons/threejs-material-table.html">Material Table</a></li>
          </ul></ul>
  <ul>
    <li><a href="https://web.archive.orghttps://github.com/gfxfundamentals/threejsfundamentals">github</a></li>
    <li><a href="https://web.archive.orghttps://threejs.org/">three.js</a></li>
    <li><a href="https://web.archive.orghttps://threejs.org/docs/">three.js docs</a></li>
  </ul>

          </div>
      </div>
      <div class="lesson-comments">
          <div>Questions? <a href="https://web.archive.orghttps://stackoverflow.com/questions/tagged/three.js">Ask on stackoverflow</a>.</div>
          <div><a href="https://web.archive.orghttps://github.com/gfxfundamentals/threejsfundamentals/issues/new?assignees=&amp;labels=suggested+topic&amp;template=suggest-topic.md&amp;title=%5BSUGGESTION%5D">Suggestion</a>? <a href="https://web.archive.orghttps://github.com/gfxfundamentals/threejsfundamentals/issues/new?assignees=&amp;labels=&amp;template=request.md&amp;title=">Request</a>? <a href="https://web.archive.orghttps://github.com/gfxfundamentals/threejsfundamentals/issues/new?assignees=&amp;labels=bug+%2F+issue&amp;template=bug-issue-report.md&amp;title=">Issue</a>? <a href="https://web.archive.orghttps://github.com/gfxfundamentals/threejsfundamentals/issues/new?assignees=&amp;labels=bug+%2F+issue&amp;template=bug-issue-report.md&amp;title=">Bug</a>?</div>

          <div id="disqus_thread"></div>
          <script type="text/javascript">
              /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
              var disqus_shortname = 'threejsfundamentals'; // required: replace example with your forum shortname
              var disqus_identifier = 'Three.js Multiple Canvases Multiple Scenes';
              var disqus_title = 'Three.js Multiple Canvases Multiple Scenes';

              /* * * DON'T EDIT BELOW THIS LINE * * */
              (function() {
                  if (window.location.hostname.indexOf("threejsfundamentals.org") < 0) {
                      return;
                  }
                  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="https://web.archive.orghttp://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="https://web.archive.orghttps://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    </div>
  </div>
</body>
</html>
